<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>ThermoMonitor</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

    <!-- Custom styles for this template -->
    <link href="css/dashboard.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="js/ie10-viewport-bug-workaround.js"></script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html#">ThermoMonitor</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li class="active"><a href="/">Dashboard</a></li>
            <li><a href="/history">History</a></li>
            <li><a href="#" onClick="$('#alert').modal('show');return false;">Shutdown</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="container">
          <h1 class="page-header">Dashboard</h1>

		  <!-- Tab panes -->
		  <div class="tab-content">
			<div class="tab-pane fade in active" id="gauge">
			  <div class="row placeholders">
				<div class="col-xs-6 col-sm-3 placeholder">
				  <div id="temp1" style="width: 100%; height: 170px;"></div>
				  <h4>Channel 1</h4>
				</div>
				<div class="col-xs-6 col-sm-3 placeholder">
				  <div id="temp2" style="width: 100%; height: 170px;"></div>
				  <h4>Channel 2</h4>
				</div>
				<div class="col-xs-6 col-sm-3 placeholder">
				  <div id="temp3" style="width: 100%; height: 170px;"></div>
				  <h4>Channel 3</h4>
				</div>
				<div class="col-xs-6 col-sm-3 placeholder">
				  <div id="temp4" style="width: 100%; height: 170px;"></div>
				  <h4>Channel 4</h4>
				</div>
			  </div>
			  <div class="row placeholders">
				<div class="col-xs-6 col-sm-3 placeholder">
				  <div id="temp5" style="width: 100%; height: 170px;"></div>
				  <h4>Channel 5</h4>
				</div>
				<div class="col-xs-6 col-sm-3 placeholder">
				  <div id="temp6" style="width: 100%; height: 170px;"></div>
				  <h4>Channel 6</h4>
				</div>
				<div class="col-xs-6 col-sm-3 placeholder">
				  <div id="temp7" style="width: 100%; height: 170px;"></div>
				  <h4>Channel 7</h4>
				</div>
				<div class="col-xs-6 col-sm-3 placeholder">
				  <div id="temp8" style="width: 100%; height: 170px;"></div>
				  <h4>Channel 8</h4>
				</div>
			  </div>
			</div>
			<div class="tab-pane fade" id="chart">
				<div id="wrapper" class="chart-inner" >
					<div id="graph" style="height:498px;"></div>
				</div>
			</div>
		  </div>

          <!-- Nav tabs -->
          <ul class="nav nav-pills" role="tablist">
          	<li class="active"><a href="#gauge" role="tab" data-toggle="tab">Gauge</a></li>
			<li><a href="#chart" role="tab" data-toggle="tab" onClick="setTimeout( resizeChart, 170 );return false;">Chart</a></li>
		  </ul>

          <h2 class="sub-header">Previous Readings</h2>
          <div class="table-responsive">
            <table class="table table-striped" id="prevData">
              <thead>
                <tr>
                  <th>Time</th>
                  <th>Channel 1</th>
                  <th>Channel 2</th>
                  <th>Channel 3</th>
                  <th>Channel 4</th>
                  <th>Channel 5</th>
                  <th>Channel 6</th>
                  <th>Channel 7</th>
                  <th>Channel 8</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Modal -->
	<div class="modal fade" id="alert" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
		<div class="modal-content">
		  <div class="modal-header">
			<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
			<h4 class="modal-title" id="myModalLabel">Are you sure?</h4>
		  </div>
		  <div class="modal-body" id="modalBody">
			Logging will be terminated when the system is shutdown.
		  </div>
		  <div class="modal-footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
			<button type="button" class="btn btn-primary" onClick="shutdown()" id="modalButtonShutdown">Shutdown</button>
		  </div>
		</div>
	  </div>
	</div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/highcharts-more.js"></script>
    <script src="http://code.highcharts.com/modules/solid-gauge.src.js"></script>
	<script>
	var chart;
	function requestData() {
		$.ajax({
			url: 'api/live/',
			success: function(points) {
				// add the point			
				$('#temp1').highcharts().series[0].points[0].update(points[1]);
				$('#temp2').highcharts().series[0].points[0].update(points[2]);
				$('#temp3').highcharts().series[0].points[0].update(points[3]);
				$('#temp4').highcharts().series[0].points[0].update(points[4]);
				$('#temp5').highcharts().series[0].points[0].update(points[5]);
				$('#temp6').highcharts().series[0].points[0].update(points[6]);
				$('#temp7').highcharts().series[0].points[0].update(points[7]);
				$('#temp8').highcharts().series[0].points[0].update(points[8]);
				
				var series = chart.series[0],
					shift = series.data.length > 20;
					
				for (i = 1; i < 9; i++){
					chart.series[i-1].addPoint([points[0], parseFloat(points[i])], true, shift);
				}
				
				$("<tr><td>" + points[0] + "</td><td>" + points[1] +"</td><td>" + points[2] + "</td><td>" + points[3] + " </td><td>" + points[4] + "</td><td>" + points[5] + "</td><td>" + points[6] + "</td><td>" + points[7] + "</td><td>" + points[8] + "</td></tr>").prependTo("#prevData > tbody");

				setTimeout(requestData, 60000);	
			},
			cache: false
		});
	}
	
	function resizeChart(){
		var chart = $('#graph').highcharts();
        var el = $('.chart-inner');
        el.css('width','100%');
        chart.setSize(el.width(),el.height(),true);
	}
	
	$(document).ready(function() {
		var gaugeOptions = {

			chart: {
				type: 'solidgauge'
			},

			title: null,

			pane: {
				center: ['50%', '85%'],
				size: '150%',
				startAngle: -90,
				endAngle: 90,
				background: {
					backgroundColor: (Highcharts.theme && Highcharts.theme.background2) || '#EEE',
					innerRadius: '60%',
					outerRadius: '100%',
					shape: 'arc'
				}
			},

			tooltip: {
				enabled: false
			},
   
			// the value axis
			yAxis: {
				stops: [
					[0.1, '#55BF3B'], // green
					[0.5, '#DDDF0D'], // yellow
					[0.9, '#DF5353'] // red
				],
				lineWidth: 0,
				minorTickInterval: null,
				tickPixelInterval: 100,
				tickWidth: 0,
				title: {
					y: -70
				},
				labels: {
					y: 0
				},
				min: -25,
				max: 105        
			},

			plotOptions: {
				solidgauge: {
					dataLabels: {
						y: 5,
						borderWidth: 0,
						useHTML: true
					}
				}
			},
			credits: {
				enabled: false
			},

			series: [{
				name: 'Temperature',
				data: [0],
				dataLabels: {
					format: '<div style="text-align:center"><span style="font-size:20px;color:' + 
						((Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black') + '">{y} 째C</span><br/>'
				},
				tooltip: {
					valueSuffix: ' 째C'
				}
			}]
	
		};
		
		chart = new Highcharts.Chart({
			chart: {
				renderTo: 'graph',
			},
			title: {
				text: ''
			},
			xAxis: {
					categories: [],
					tickInterval: 3
			},
			yAxis: {
				title: {
						text: 'Temperature (째C)'
				}
			},
			tooltip: {
					valueSuffix: ' 째C'
			},
			credits: {
				enabled: false
			},
			series: [{
				name: 'Channel 1',
				data: []
			},{
				name: 'Channel 2',
				data: []
			},{
				name: 'Channel 3',
				data: []
			},{
				name: 'Channel 4',
				data: []
			},{
				name: 'Channel 5',
				data: []
			},{
				name: 'Channel 6',
				data: []
			},{
				name: 'Channel 7',
				data: []
			},{
				name: 'Channel 8',
				data: []
			}]
		});
	
		$('#temp1').highcharts(gaugeOptions);
		$('#temp2').highcharts(gaugeOptions);
		$('#temp3').highcharts(gaugeOptions);
		$('#temp4').highcharts(gaugeOptions);
		$('#temp5').highcharts(gaugeOptions);
		$('#temp6').highcharts(gaugeOptions);
		$('#temp7').highcharts(gaugeOptions);
		$('#temp8').highcharts(gaugeOptions);	
		
		requestData();
	});
	
	function shutdown(){
		$.ajax({
			url: 'shutdown',
			success: function(response) {
				$('#modalBody').text("Shutting Down...");
				$('#modalButtonShutdown').prop('disabled', true);
			},
			cache: false
		});
	}
	</script>
  </body>
</html>
